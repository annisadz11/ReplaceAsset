@* @{
    ViewData["Title"] = "New Asset Replacement";
}

<link href="~/vendor/bootstrap-table/bootstrap-table.min.css" relstylesheet" />
<link href="~/vendor/bootstrap-table/bootstrap-table-sticky-header.css" rel="stylesheet" />

<div class="row gutters mt-4">
    <div class="card">
        <div class="card-header text-center">New Asset Replacement</div>
        <hr class="m-0" />
        <div class="card-body">
            <table id="table"
                   data-toggle="table"
                   data-locale="en-US"
                   data-sticky-header="true"
                   data-sticky-header-offset-y="60"
                   data-search="true"
                   data-toolbar="#toolbar"
                   data-search-highlight="true"
                   data-search-align="right"
                   data-show-toggle="true"
                   data-show-refresh="true"
                   data-show-columns="true"
                   data-buttons="[]"
                   data-key-events="true"
                   data-url="@Url.Action("GetData", "NewAssetReplacements")"
                   data-pagination="true"
                   data-side-pagination="server"
                   data-show-columns-toggle-all="true"
                   data-pagination-loop="false"
                   data-pagination-pre-text="Previous"
                   data-pagination-next-text="Next"
                   data-page-size="50">
                <thead>
                    <tr>
                        <th data-field="name" data-sortable="true" data-width="200">Name</th>
                        <th data-field="departement" data-sortable="true" data-width="150">Departement</th>
                        <th data-field="type" data-sortable="true" data-width="100">Type</th>
                        <th data-field="serialNumber" data-sortable="true" data-width="150">Serial Number</th>
                        <th data-field="newType" data-sortable="true" data-width="150">New Type</th>
                        <th data-field="newSerialNumber" data-sortable="true" data-width="150">New Serial Number</th>
                        <th data-field="dateReplace" data-sortable="true" data-width="150">Date Replace</th>
                        <th data-formatter="actionFormatter" class="text-center no-space-three text-nowrap" data-width="250">Actions</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/vendor/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="~/vendor/bootstrap-table/bootstrap-table-sticky-header.min.js"></script>
    <script src="~/vendor/bootstrap-table/bootstrap-table-filter-control.min.js"></script>
    <script>
        function actionFormatter(value, row, index) {
            var updateBtn = '<button type="button" class="btn btn-sm btn-warning" onclick="showUpdateModal(' + row.id + ')">Update</button>';
            var detailsBtn = '<button type="button" class="btn btn-sm btn-info" onclick="showDetails(' + row.id + ')">Details</button>';
            var deleteBtn = '<button type="button" class="btn btn-danger btn-sm" onclick="deleteRequest(' + row.id + ')">Delete</button>';
            return updateBtn + ' ' + detailsBtn + ' ' + deleteBtn;
        }

        // Fungsi untuk menampilkan modal update
        function showUpdateModal(id) {
            // Fill the form with the current details from the table or fetch them from server
            // Open the modal window
        }

        // Fungsi untuk menampilkan details
        function showDetails(id) {
            // Show details from the server or table
        }

        // Fungsi untuk menghapus request
        function deleteRequest(id) {
            // AJAX call to delete request from the database
        }
    </script>
} *@

@{
    ViewData["Title"] = "New Asset Replacement";
}

<link href="~/vendor/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
<link href="~/vendor/bootstrap-table/bootstrap-table-sticky-header.css" rel="stylesheet" />

<div class="row gutters mt-4">
    <div class="card">
        <div class="card-header text-center" style="font-size: 1.00rem;">New Asset Replacement</div>
        <hr class="m-0" />
        <div class="card-body">
            <table id="table"
                   data-toggle="table"
                   data-locale="en-US"
                   data-sticky-header="true"
                   data-sticky-header-offset-y="60"
                   data-search="true"
                   data-toolbar="#toolbar"
                   data-search-highlight="true"
                   data-search-align="right"
                   data-show-toggle="true"
                   data-show-refresh="true"
                   data-show-columns="true"
                   data-buttons="[]"
                   data-key-events="true"
                   data-url="@Url.Action("GetData", "NewAssetReplacements")"
                   data-pagination="true"
                   data-side-pagination="server"
                   data-show-columns-toggle-all="true"
                   data-pagination-loop="false"
                   data-pagination-pre-text="Previous"
                   data-pagination-next-text="Next"
                   data-page-size="50">
                <thead>
                    <tr>
                        <th data-field="assetRequestName" data-sortable="true" data-width="200">Requestor</th>
                        <th data-field="assetRequestDepartment" data-sortable="true" data-width="150">Department</th>
                        <th data-field="assetRequestType" data-sortable="true" data-width="100">Type</th>
                        <th data-field="assetRequestSerialNumber" data-sortable="true" data-width="150">Serial Number</th>
                        <th data-field="assetRequestBaseline" data-sortable="true" data-width="150">Baseline</th>
                        <th data-field="assetRequestUsageLocation" data-sortable="true" data-width="150">Usage Location</th>
                        <th data-field="assetRequestReason" data-sortable="true" data-width="300">Reason</th>
                        <th data-field="assetRequestJustify" data-sortable="true" data-width="200">Justify</th>
                        <th data-field="assetRequestTypeReplace" data-sortable="true" data-width="200">Type Replace</th>
                        <th data-field="assetRequestApprovalDate" data-sortable="true" data-width="150">Approval Date</th>
                        <th data-field="newType" data-sortable="true" data-width="100">New Asset Type</th>
                        <th data-field="newSerialNumber" data-sortable="true" data-width="150">New Serial Number</th>
                        <th data-field="dateReplace" data-sortable="true" data-width="150">Date Replace</th>
                        <th data-formatter="actionFormatter" class="text-center no-space-three text-nowrap" data-width="100">Actions</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
<!-- Modal Update New Asset Replacement -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateModalLabel">Update New Asset Replacement</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="updateForm">
                    <input type="hidden" id="updateId" name="id" />
                    <div class="mb-3">
                        <label for="newType" class="form-label">New Type</label>
                        <input type="text" class="form-control" id="newType" name="newType" required>
                    </div>
                    <div class="mb-3">
                        <label for="newSerialNumber" class="form-label">New Serial Number</label>
                        <input type="text" class="form-control" id="newSerialNumber" name="newSerialNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="dateReplace" class="form-label">Date Replace</label>
                        <input type="date" class="form-control" id="dateReplace" name="dateReplace">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/vendor/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="~/vendor/bootstrap-table/bootstrap-table-sticky-header.min.js"></script>
    <script src="~/vendor/bootstrap-table/bootstrap-table-filter-control.min.js"></script>
    <script src="~/js/bootstrap.bundle.min.js"></script>
    <script src="~/vendor/notyf/notyf.min.js"></script>

    <script>
        var notyf = new Notyf({
            position: {
                x: 'center',
                y: 'top',
            },
            // Anda juga bisa menambahkan offset jika perlu
            ripple: true,
            dismissible: true,
            duration: 3000  // Lama notifikasi ditampilkan, dalam milidetik
        });


       function actionFormatter(value, row, index) {
            var updateBtn = '<button type="button" class="btn btn-sm btn-warning" onclick="showUpdateModal(' + row.id + ')">Update</button>';
            var detailsBtn = '<button type="button" class="btn btn-sm btn-info" onclick="showDetails(' + row.id + ')">Details</button>';
            var deleteBtn = '<button type="button" class="btn btn-danger btn-sm" onclick="deleteRequest(' + row.id + ')">Delete</button>';
            return updateBtn + ' ' + detailsBtn + ' ' + deleteBtn;
        }

        // Fungsi untuk menampilkan modal update
        function showUpdateModal(id) {
            $.ajax({
                url: '@Url.Action("GetById", "NewAssetReplacements")', // Asumsikan Anda memiliki method GetById di controller
                data: { id: id },
                type: 'GET',
                success: function (data) {
                    $('#updateId').val(data.id);
                    $('#newType').val(data.newType);
                    $('#newSerialNumber').val(data.newSerialNumber);
                    $('#dateReplace').val(data.dateReplace ? data.dateReplace.split('T')[0] : ''); // Convert datetime to date input format
                    $('#updateModal').modal('show');
                }
            });
        }

        $('#updateForm').on('submit', function (e) {
            e.preventDefault();

            var data = $(this).serialize();

            $.ajax({
                url: '@Url.Action("Update", "NewAssetReplacements")', // Pastikan Anda memiliki route ini di controller
                data: data,
                type: 'POST',
                success: function (result) {
                    if (result.success) {
                        $('#updateModal').modal('hide');
                        $('#table').bootstrapTable('refresh');
                        notyf.success('Data berhasil di-update.'); // Tampilkan notifikasi sukses
                    } else {
                        notyf.error(result.message); // Tampilkan notifikasi error jika ada
                    }
                }
            });
        });

        // existing showDetails and deleteRequest functions if any...
    </script>
}